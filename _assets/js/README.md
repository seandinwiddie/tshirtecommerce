Didn't write this- just added in a few lines, per comment in pattern.js.
